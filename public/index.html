<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.png">
    <title>Authing SSO</title>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but sso doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
  <script>
    const appId = '5c7fe3e731b9b47e1578f01a';
    const domain = "sso.authing.cn/login?client_id=YOUR_CLIENT_ID_";
    const guard = new AuthingGuard(appId, domain, {
      hideClose: true,
      title: 'LearnSoLiD.Chat',
      logo: 'https://usercontents.authing.cn/user-app-logo/FpJ_CjBPB8MgtJ6-6BNAYJWQkQUf',
    });

    guard.on('authenticated', async (authing) => {
      if (guard.isLogged()) {
        // 已登录，直接跳至授权页
        // guard.sysAuthorize();
      }
    });

    guard.on('login', (userInfo) => {
      console.log('用户登录成功', userInfo);

      localStorage.setItem("accessToken", userInfo.token);
      localStorage.setItem("userInfo", JSON.stringify(userInfo));

      // Update DOM
      // location.href = '/login/authorize?';
      guard.userAuthorize();
    });

    guard.on('loginError', (error) => {
      // Handle error 
      console.log('用户登录失败', error);
    });
  </script>
</html>
